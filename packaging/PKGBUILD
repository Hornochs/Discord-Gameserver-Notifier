# Maintainer: LAN.party Team <packaging@lan.party>
pkgname=discord-gameserver-notifier
pkgver=VERSION_PLACEHOLDER
pkgrel=1
pkgdesc="Automated Discord notifications for LAN gameservers"
arch=('any')
url="https://github.com/lan-dot-party/Discord-Gameserver-Notifier"
license=('GPL3')
depends=('python>=3.7' 'python-pip' 'python-virtualenv' 'python-yaml' 'systemd')
makedepends=('python-build' 'python-installer' 'python-wheel' 'python-hatchling')
source=("$pkgname-$pkgver.whl")
sha256sums=('SKIP')

build() {
    # No build step needed for wheel installation
    true
}

package() {
    # Install the wheel
    python -m installer --destdir="$pkgdir" "$srcdir/$pkgname-$pkgver.whl"
    
    # Install systemd service
    install -Dm644 "$srcdir/discord-gameserver-notifier.service" \
        "$pkgdir/usr/lib/systemd/system/discord-gameserver-notifier.service"
    
    # Install executable wrapper
    install -Dm755 "$srcdir/discord-gameserver-notifier-exec" \
        "$pkgdir/usr/bin/discord-gameserver-notifier"
    
    # Create required directories
    install -dm755 "$pkgdir/etc/dgn"
    install -dm755 "$pkgdir/var/lib/dgn"
    install -dm755 "$pkgdir/var/log/dgn"
    install -dm755 "$pkgdir/opt"
    
    # Install example configurations
    install -Dm644 "$srcdir/config.yaml.example" \
        "$pkgdir/usr/share/doc/$pkgname/config.yaml.example"
    install -Dm644 "$srcdir/config.yaml.service-example" \
        "$pkgdir/usr/share/doc/$pkgname/config.yaml.service-example"
} 